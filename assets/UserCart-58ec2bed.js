import{u as j,r as b,f as k,o as n,c as d,g as c,a as e,F as w,j as q,k as p,t as u,w as C,v as V,h as D,n as P,b as I,l as x}from"./index-ad2ebd01.js";import{i as m}from"./backend-94c38ddf.js";const T={class:"container"},O={class:"row mt-4"},R={class:"col-md-7"},A={class:"table align-middle"},G=e("thead",null,[e("tr",null,[e("th",null,"圖片"),e("th",null,"商品名稱"),e("th",null,"價格"),e("th")])],-1),H={style:{width:"200px"}},J={href:"#",class:"text-dark"},K={key:0,class:"h5"},Q={key:1,class:"h6"},W={key:2,class:"h5"},X={class:"btn-group btn-group-sm"},Y=["onClick"],Z=["disabled","onClick"],ee={key:0,class:"spinner-grow text-danger spinner-grow-sm",role:"status"},te=e("span",{class:"visually-hidden"},"Loading...",-1),se=[te],ae={class:"col-md-5"},le={class:"sticky-top"},oe={class:"table align-middle"},ne=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"110px"}},"數量"),e("th",null,"單價")])],-1),de=["disabled","onClick"],ce=e("i",{class:"bi bi-x"},null,-1),ie=[ce],re={key:0,class:"text-success"},ue={class:"input-group input-group-sm"},_e=["disabled","onChange","onUpdate:modelValue"],pe={class:"input-group-text"},ve={class:"text-end"},me={key:0,class:"text-success"},be=e("td",{colspan:"3",class:"text-end"},"總計",-1),he={class:"text-end"},ge={key:0},fe=e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),ye={class:"text-end text-success"},ke={class:"input-group mb-3 input-group-sm"},xe={class:"my-5 row justify-content-center"},we={class:"mb-3"},Ce=e("label",{for:"email",class:"form-label"},"Email",-1),Ve={class:"mb-3"},Ie=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),$e={class:"mb-3"},Ue=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),qe={class:"mb-3"},Fe=e("label",{for:"address",class:"form-label"},"收件人地址",-1),Le={class:"mb-3"},Ee=e("label",{for:"message",class:"form-label"},"留言",-1),Ne=e("div",{class:"text-end"},[e("button",{class:"btn btn-danger"},"送出訂單")],-1),Se={__name:"UserCart",setup(ze){const $=j(),U=b([]),i=b({}),g=b(""),r=b({loadingItem:""}),_=b(!0);function F(s){$.push(`/user/product/${s}`)}async function L(){r.value.isLoading=!0;const s=await m.get("api/karabo-api-cake/products/all");U.value=s.data.products,_.value=!1}async function E(s){r.value.loadingItem=s;const a={product_id:s,qty:1},v=await m.post("api/karabo-api-cake/cart",{data:a});r.value.loadingItem="",console.log(v),await h()}async function h(){_.value=!0;const s=await m.get("api/karabo-api-cake/cart");i.value=s.data.data,_.value=!1}async function N(s){_.value=!0,r.value.loadingItem=s.id;const a={product_id:s.product_id,qty:s.qty},v=await m.put(`api/karabo-api-cake/cart/${s.id}`,{data:a});console.log(v),r.value.loadingItem="",await h()}async function z(s){_.value=!0,await m.delete(`/api/karabo-api-cake/cart/${s}`),await h()}async function B(){_.value=!0;const s={code:g.value},a=await m.post("api/karabo-api-cake/coupon",{data:s});g.value="",console.log(a),await h(),_.value=!1}const l=b({user:{name:"",email:"",tel:"",address:""},message:""});async function M(){try{const s=l.value;let v=(await m.post("api/karabo-api-cake/order",{data:s})).data.orderId;l.value.message="",l.value.user.name="",l.value.user.email="",l.value.user.tel="",l.value.user.address="",$.push(`/user/checkout/${v}`)}catch(s){console.log(s)}}return L(),h(),(s,a)=>{const v=k("Load-ing"),f=k("v-Field"),y=k("ErrorMessage"),S=k("v-Form");return n(),d(w,null,[c(v,{active:_.value},null,8,["active"]),e("div",T,[e("div",O,[e("div",R,[e("table",A,[G,e("tbody",null,[(n(!0),d(w,null,q(U.value,t=>(n(),d("tr",{key:t.id},[e("td",H,[e("div",{style:P([{height:"100px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${t.imageUrl})`}])},null,4)]),e("td",null,[e("a",J,u(t.title),1)]),e("td",null,[t.price?p("",!0):(n(),d("div",K,u(t.origin_price)+" 元",1)),t.price?(n(),d("del",Q,"原價 "+u(t.origin_price)+" 元",1)):p("",!0),t.price?(n(),d("div",W,"現在只要 "+u(t.price)+" 元",1)):p("",!0)]),e("td",null,[e("div",X,[e("button",{type:"button",class:"btn btn-outline-secondary",onClick:o=>F(t.id)}," 查看更多 ",8,Y),e("button",{type:"button",class:"btn btn-outline-danger",disabled:r.value.loadingItem===t.id,onClick:o=>E(t.id)},[r.value.loadingItem===t.id?(n(),d("div",ee,se)):p("",!0),I(" 加到購物車 ")],8,Z)])])]))),128))])])]),e("div",ae,[e("div",le,[e("table",oe,[ne,e("tbody",null,[i.value.carts?(n(!0),d(w,{key:0},q(i.value.carts,t=>(n(),d("tr",{key:t.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",disabled:r.value.loadingItem===t.id,onClick:o=>z(t.id)},ie,8,de)]),e("td",null,[I(u(t.product.title)+" ",1),t.coupon?(n(),d("div",re," 已套用優惠券 ")):p("",!0)]),e("td",null,[e("div",ue,[C(e("input",{type:"number",class:"form-control",disabled:t.id===r.value.loadingItem,onChange:o=>N(t),"onUpdate:modelValue":o=>t.qty=o,min:"1"},null,40,_e),[[V,t.qty,void 0,{number:!0}]]),e("div",pe,"/ "+u(t.product.unit),1)])]),e("td",ve,[i.value.final_total!==i.value.total?(n(),d("small",me,"折扣價：")):p("",!0),I(" "+u(s.$filters.currency(t.final_total)),1)])]))),128)):p("",!0)]),e("tfoot",null,[e("tr",null,[be,e("td",he,u(s.$filters.currency(i.value.total)),1)]),i.value.final_total!==i.value.total?(n(),d("tr",ge,[fe,e("td",ye,u(s.$filters.currency(i.value.final_total)),1)])):p("",!0)])]),e("div",ke,[C(e("input",{type:"text",class:"form-control","onUpdate:modelValue":a[0]||(a[0]=t=>g.value=t),placeholder:"請輸入優惠碼"},null,512),[[V,g.value]]),e("div",{class:"input-group-append"},[e("button",{class:"btn btn-outline-secondary",type:"button",onClick:B}," 套用優惠碼 ")])])])])]),e("div",xe,[c(S,{class:"col-md-6",onSubmit:M},{default:D(({errors:t})=>[e("div",we,[Ce,c(f,{id:"email",name:"email",type:"email",class:x(["form-control",{"is-invalid":t.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:l.value.user.email,"onUpdate:modelValue":a[1]||(a[1]=o=>l.value.user.email=o)},null,8,["class","modelValue"]),c(y,{name:"email",class:"invalid-feedback"})]),e("div",Ve,[Ie,c(f,{id:"name",name:"姓名",type:"text",class:x(["form-control",{"is-invalid":t.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:l.value.user.name,"onUpdate:modelValue":a[2]||(a[2]=o=>l.value.user.name=o)},null,8,["class","modelValue"]),c(y,{name:"姓名",class:"invalid-feedback"})]),e("div",$e,[Ue,c(f,{id:"tel",name:"電話",type:"tel",class:x(["form-control",{"is-invalid":t.電話}]),placeholder:"請輸入電話",rules:"required",modelValue:l.value.user.tel,"onUpdate:modelValue":a[3]||(a[3]=o=>l.value.user.tel=o)},null,8,["class","modelValue"]),c(y,{name:"電話",class:"invalid-feedback"})]),e("div",qe,[Fe,c(f,{id:"address",name:"地址",type:"text",class:x(["form-control",{"is-invalid":t.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:l.value.user.address,"onUpdate:modelValue":a[4]||(a[4]=o=>l.value.user.address=o)},null,8,["class","modelValue"]),c(y,{name:"地址",class:"invalid-feedback"})]),e("div",Le,[Ee,C(e("textarea",{name:"",id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":a[5]||(a[5]=o=>l.value.message=o)},null,512),[[V,l.value.message]])]),Ne]),_:1})])])],64)}}};export{Se as default};
