import{i as h}from"./backend-556194ba.js";import{r as n,l as L,z as C,o as p,c as _,a as e,w as v,v as f,A as U,d as V,e as M,F as T,h as B,t as w}from"./index-150f1a48.js";import{M as N}from"./modal-e4494c62.js";import{_ as S}from"./DelModal-597c4ee4.js";import"./component-functions-ad01dfa8.js";const A={class:"modal-dialog",role:"document"},F={class:"modal-content"},I=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},"Modal title"),e("h5",{class:"modal-title",id:"exampleModalLabel"},"優惠券"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),O={class:"modal-body"},j={class:"mb-3"},z=e("label",{for:"title"},"標題",-1),E={class:"mb-3"},P=e("label",{for:"coupon_code"},"優惠碼",-1),q={class:"mb-3"},G=e("label",{for:"due_date"},"到期日",-1),H={class:"mb-3"},J=e("label",{for:"price"},"折扣百分比",-1),K={class:"mb-3"},Q={class:"form-check"},R=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),W=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close",-1),X={__name:"CouponModal",props:{coupon:{type:Object}},emits:["update-coupon"],setup(g,{expose:m,emit:i}){const c=g,a=n(null),s=n({}),l=n({}),d=n(null),y=()=>{s.value.show()},r=()=>{s.value.hide()};L(()=>{s.value=new N(a.value)}),m({myModal_show:y,myModal_hide:r});function k(){i("update-coupon",l.value)}return C(()=>c.coupon,()=>{l.value=c.coupon;const b=new Date(l.value.due_date*1e3).toISOString().split("T");d.value=b[0]},{deep:!0}),C(()=>d.value,()=>{l.value.due_date=Math.floor(new Date(d.value)/1e3)},{deep:!0}),(b,o)=>(p(),_("div",{class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"modal",ref:a},[e("div",A,[e("div",F,[I,e("div",O,[e("div",j,[z,v(e("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":o[0]||(o[0]=t=>l.value.title=t),placeholder:"請輸入標題"},null,512),[[f,l.value.title]])]),e("div",E,[P,v(e("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":o[1]||(o[1]=t=>l.value.code=t),placeholder:"請輸入優惠碼"},null,512),[[f,l.value.code]])]),e("div",q,[G,v(e("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":o[2]||(o[2]=t=>d.value=t)},null,512),[[f,d.value]])]),e("div",H,[J,v(e("input",{type:"number",class:"form-control",id:"price","onUpdate:modelValue":o[3]||(o[3]=t=>l.value.percent=t),placeholder:"請輸入折扣百分比"},null,512),[[f,l.value.percent,void 0,{number:!0}]])]),e("div",K,[e("div",Q,[v(e("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":o[4]||(o[4]=t=>l.value.is_enabled=t),id:"is_enabled"},null,512),[[U,l.value.is_enabled]]),R])])]),e("div",{class:"modal-footer"},[W,e("button",{type:"button",class:"btn btn-primary",onClick:k},"更新優惠券 ")])])])],512))}},Y={class:"text-end mt-4"},Z={class:"table mt-4"},ee=e("thead",null,[e("tr",null,[e("th",null,"名稱"),e("th",null,"折扣百分比"),e("th",null,"到期日"),e("th",null,"是否啟用"),e("th",null,"編輯")])],-1),oe={key:0,class:"text-success"},te={key:1,class:"text-muted"},le={class:"btn-group"},ae=["onClick"],ne=["onClick"],re={__name:"CouPons",setup(g){const m=n(null),i=n(null),c=n({}),a=n({title:"",is_enabled:0,percent:100,code:""}),s=n(!1),l=n(!1);function d(o,t){l.value=o,l.value?a.value={due_date:new Date().getTime()/1e3}:a.value={...t},i.value.myModal_show()}function y(o){a.value={...o},m.value.myModal_show()}async function r(){s.value=!0;const o=await h.get("api/karabo-api-cake/admin/coupons");console.log("優惠券",o),c.value=o.data.coupons,s.value=!1}async function k(o){if(l.value){const t=await h.post("api/karabo-api-cake/admin/coupon",{data:o});console.log(t,o),await r(),i.value.myModal_hide()}else{const t=await h.put(`api/karabo-api-cake/admin/coupon/${o.value.id}`,{data:o});console.log(t),await r(),i.value.myModal_hide()}}async function b(){s.value=!0;const o=await h.delete(`api/karabo-api-cake/admin/coupon/${a.value.id}`);console.log(o,a.value),m.value.myModal_hide(),await r()}return r(),console.log(c.value),(o,t)=>{const $=V("Load-ing");return p(),_("div",null,[M($,{active:s.value},null,8,["active"]),e("div",Y,[e("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=u=>d(!0))}," 建立新的優惠券 ")]),e("table",Z,[ee,e("tbody",null,[(p(!0),_(T,null,B(c.value,(u,x)=>(p(),_("tr",{key:x},[e("td",null,w(u.title),1),e("td",null,w(u.percent)+"%",1),e("td",null,w(o.$filters.date(u.due_date)),1),e("td",null,[u.is_enabled===1?(p(),_("span",oe,"啟用")):(p(),_("span",te,"未起用"))]),e("td",null,[e("div",le,[e("button",{class:"btn btn-outline-primary btn-sm",onClick:D=>d(!1,u)},"編輯",8,ae),e("button",{class:"btn btn-outline-danger btn-sm",onClick:D=>y(u)},"刪除",8,ne)])])]))),128))])]),M(X,{coupon:a.value,ref_key:"couponModal",ref:i,onUpdateCoupon:k},null,8,["coupon"]),M(S,{item:a.value,ref_key:"delModal",ref:m,onDelItem:b},null,8,["item"])])}}};export{re as default};
