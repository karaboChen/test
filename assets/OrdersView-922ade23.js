import{f as d,l as D,y as N,o as a,c as s,a as t,t as l,h as x,F as f,g as C,r as P,b as $,j as B,i as E,z as S}from"./index-7e59a937.js";import{M as j,_ as q}from"./DelModal-69f7e0ca.js";import{_ as z}from"./PagiNation-749af4bc.js";import{i as w}from"./backend-c2d93911.js";import"./component-functions-9f0d7677.js";const F={class:"modal-dialog modal-xl",role:"document"},I={class:"modal-content border-0"},A=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),G={class:"modal-body"},H={class:"row"},J={class:"col-md-4"},K=t("h3",null,"用戶資料",-1),Q={class:"table"},R={key:0},T=t("th",{style:{width:"100px"}},"姓名",-1),W=t("th",null,"Email",-1),X=t("th",null,"電話",-1),Y=t("th",null,"地址",-1),Z={class:"col-md-8"},tt=t("h3",null,"訂單細節",-1),et={class:"table"},lt=t("th",{style:{width:"100px"}},"訂單編號",-1),at=t("th",null,"下單時間",-1),st=t("th",null,"付款時間",-1),ot={key:0},nt={key:1},dt=t("th",null,"付款狀態",-1),ut={key:0,class:"text-success"},rt={key:1,class:"text-muted"},it=t("th",null,"總金額",-1),ct=t("h3",null,"選購商品",-1),_t={class:"table"},ht=t("thead",null,[t("tr")],-1),pt={class:"text-end"},vt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消 ",-1),mt={__name:"OrderModal",props:{order:{type:Object,default:()=>({})}},emits:["update-order"],setup(O,{expose:k,emit:m}){const _=O,b=d({}),y=d(null),u=d(!1),e=d({});function h(){m("update-order",e.value)}const p=()=>{b.value.show()},g=()=>{b.value.hide()};return D(()=>{b.value=new j(y.value)}),k({myModal_show:p,myModal_hide:g}),N(()=>_.order,()=>{e.value=_.order,u.value=e.value.is_paid},{deep:!0}),(v,M)=>(a(),s("div",{class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"modal",ref:y},[t("div",F,[t("div",I,[A,t("div",G,[t("div",H,[t("div",J,[K,t("table",Q,[e.value.user?(a(),s("tbody",R,[t("tr",null,[T,t("td",null,l(e.value.user.name),1)]),t("tr",null,[W,t("td",null,l(e.value.user.email),1)]),t("tr",null,[X,t("td",null,l(e.value.user.tel),1)]),t("tr",null,[Y,t("td",null,l(e.value.user.address),1)])])):x("",!0)])]),t("div",Z,[tt,t("table",et,[t("tbody",null,[t("tr",null,[lt,t("td",null,l(e.value.id),1)]),t("tr",null,[at,t("td",null,l(v.$filters.date(e.value.create_at)),1)]),t("tr",null,[st,t("td",null,[e.value.paid_date?(a(),s("span",ot,l(v.$filters.date(e.value.paid_date)),1)):(a(),s("span",nt,"時間不正確"))])]),t("tr",null,[dt,t("td",null,[e.value.is_paid?(a(),s("strong",ut,"已付款")):(a(),s("span",rt,"尚未付款"))])]),t("tr",null,[it,t("td",null,l(v.$filters.currency(e.value.total)),1)])])]),ct,t("table",_t,[ht,t("tbody",null,[(a(!0),s(f,null,C(e.value.products,c=>(a(),s("tr",{key:c.id},[t("th",null,l(c.product.title),1),t("td",null,l(c.qty)+" / "+l(c.product.unit),1),t("td",pt,l(v.$filters.currency(c.final_total)),1)]))),128))])])])])]),t("div",{class:"modal-footer"},[vt,t("button",{type:"button",class:"btn btn-primary",onClick:h},"確認")])])])],512))}},bt={class:"table mt-4"},yt=t("thead",null,[t("tr",null,[t("th",null,"購買時間"),t("th",null,"Email"),t("th",null,"購買款項"),t("th",null,"應付金額"),t("th",null,"是否付款"),t("th",null,"編輯")])],-1),ft=["textContent"],kt={class:"list-unstyled"},$t={class:"text-right"},gt={class:"form-check form-switch"},Mt=["id","onUpdate:modelValue","onChange"],wt=["for"],xt={key:0},Ct={key:1},Ot={class:"btn-group"},Lt=["onClick"],Vt=["onClick"],Et={__name:"OrdersView",setup(O){const k=d(null),m=d(null),_=d({}),b=d(!1),y=d({}),u=d(!1),e=d({}),h=d(1);async function p(n=1){h.value=n;const r=await w.get(`api/karabo-api-cake/admin/orders?page=${h.value}`);console.log(r),u.value=!0,_.value=r.data.orders,y.value=r.data.pagination,u.value=!1}function g(n,r){e.value={...r},b.value=n,k.value.myModal_show()}function v(n){e.value={...n},console.log(e.value),m.value.myModal_show()}async function M(n){u.value=!0;const r={is_paid:n.is_paid};await w.put(`api/karabo-api-cake/admin/order/${n.id}`,{data:r}),u.value=!1,p(h.value)}async function c(){u.value=!0;const n=await w.delete(`api/karabo-api-cake/admin/order/${e.value.id}`);console.log(n),m.value.myModal_hide(),p(h.value)}return p(),(n,r)=>{const L=P("Load-ing");return a(),s(f,null,[$(L,{active:u.value},null,8,["active"]),t("table",bt,[yt,t("tbody",null,[(a(!0),s(f,null,C(_.value,(o,V)=>(a(),s(f,{key:V},[_.value.length?(a(),s("tr",{key:0,class:B({"text-secondary":!o.is_paid})},[t("td",null,l(n.$filters.date(o.create_at)),1),t("td",null,[o.user?(a(),s("span",{key:0,textContent:l(o.user.email)},null,8,ft)):x("",!0)]),t("td",null,[t("ul",kt,[(a(!0),s(f,null,C(o.products,(i,U)=>(a(),s("li",{key:U},l(i.product.title)+" 數量："+l(i.qty)+" "+l(i.product.unit),1))),128))])]),t("td",$t,l(o.total),1),t("td",null,[t("div",gt,[E(t("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${o.id}`,"onUpdate:modelValue":i=>o.is_paid=i,onChange:i=>M(o)},null,40,Mt),[[S,o.is_paid]]),t("label",{class:"form-check-label",for:`paidSwitch${o.id}`},[o.is_paid?(a(),s("span",xt,"已付款")):(a(),s("span",Ct,"未付款"))],8,wt)])]),t("td",null,[t("div",Ot,[t("button",{class:"btn btn-outline-primary btn-sm",onClick:i=>g(!1,o)},"檢視",8,Lt),t("button",{class:"btn btn-outline-danger btn-sm",onClick:i=>v(o)},"刪除",8,Vt)])])],2)):x("",!0)],64))),128))])]),$(mt,{order:e.value,ref_key:"orderModal",ref:k,onUpdateOrder:M},null,8,["order"]),$(q,{item:e.value,ref_key:"delModal",ref:m,onDelItem:c},null,8,["item"]),$(z,{pages:y.value,onUpdatePage:p},null,8,["pages"])],64)}}};export{Et as default};
